! function(a, b, c) {
    var d = a.r4 = {
        utils: {},
        cache: {}
    };
    d.utils.init = function() {
        d.cache.window = $(a), d.cache.document = $(b), d.cache.html = $("html"), d.cache.body = $("body"), d.cache.workPosition = 0, d.cache.header = d.cache.body.find("header"), d.cache.footer = d.cache.body.find("footer"), d.cache.video = d.cache.body.find("#video"), d.cache.videoInterval = null, d.cache.frameCount = 0, d.cache.isLayerOpened = !1, d.cache.isLayerEgo = !1, d.cache.isDetail = !1, d.cache.parallaxSpeed = .666, d.cache.maxOpacity = .75, d.cache.swiffyObject = null, d.cache.CallInit = !1, d.mobile = !1, d.bounds = [
            [1e3, 1e4, function() {
                mobile = !1
            }],
            [0, 1e3, function() {
                mobile = !0
            }]
        ], d.lastBound = -1
    }, d.utils.requestAnimationFrame = function() {
        ! function() {
            for (var b = 0, c = ["webkit", "moz"], d = 0; d < c.length && !a.requestAnimationFrame; ++d) a.requestAnimationFrame = a[c[d] + "RequestAnimationFrame"], a.cancelAnimationFrame = a[c[d] + "CancelAnimationFrame"] || a[c[d] + "CancelRequestAnimationFrame"];
            a.requestAnimationFrame || (a.requestAnimationFrame = function(c) {
                var d = (new Date).getTime(),
                    e = Math.max(0, 16 - (d - b)),
                    f = a.setTimeout(function() {
                        c(d + e)
                    }, e);
                return b = d + e, f
            }), a.cancelAnimationFrame || (a.cancelAnimationFrame = function(a) {
                clearTimeout(a)
            })
        }()
    }, d.utils.resize = function(a) {
        var b = d.cache.window.height();
        if (d.utils.calcBounds(d.cache.window, d.bounds, d.lastBound, a), d.cache.isDetail) $("#js-detail").find(".prev, .next").css({
            top: (b + 30 + 178) / 2
        });
        else {
            var c = .6 * (b - 178);
            setTimeout(function() {
                d.cache.workPosition = $("#work").offset().top
            }, 200), $("#swiffycontainer").css({
                height: c,
                "margin-top": -(c - 178) / 2
            }), d.cache.isLayerOpened || (d.utils.initParallax(d.cache.parallaxSpeed), d.utils.initReduceOpacity(d.cache.maxOpacity))
        }
    }, d.utils.calcBounds = function(a, b, c) {
        for (var e = a.width(), f = a.height(), g = $(".screen img"), h = 0, i = b.length; i > h; h++) e > b[h][0] && e < b[h][1] && c !== h && (b[h][2](), c = h);
        g.each(e > 1680 ? function() {
            $(this).attr("src", "/references/" + $(this).data("wide"))
        } : e > 1e3 && 1680 >= e ? function() {
            $(this).attr("src", "/references/" + $(this).data("mid"))
        } : function() {
            $(this).attr("src", "/references/" + $(this).data("thin"))
        }), d.utils.bg($(".home .bg"), e, f, "", !1), d.utils.bg($("#js-detail .bg"), e, f, "", !1), g.each(function() {
            d.utils.bg($(this), e, f, "element", !0)
        }), d.utils.bg($(".e404 img"), e, f, "", !1), d.cache.isLayerEgo && d.utils.resizeVideo(), d.utils.scroll(e, f), d.utils.btnopen()
    }, d.utils.bg = function(a, b, c, d, e) {
        var f, g, h, i, j, k = a.data("width"),
            l = a.data("height");
        e ? b > 1680 ? f = 1 : b > 1e3 ? (k = 1680, f = Math.max(c / l, b / k)) : (k = 1e3, f = Math.max(c / l, b / k)) : f = Math.max(c / l, b / k), g = f * k, h = f * l, i = (b - g) / 2, j = (c - h) / 2, "element" === d ? $(a).width(g).height(h).css("margin-left", i + "px").css("top", j + "px") : $(a).width(g).height(h).css("left", i + "px").css("top", j + "px")
    }, d.utils.scrollto = function(a) {
        d.utils.closelayer(), a = null !== a ? a : 0, $("html, body").stop().animate({
            scrollTop: a + "px"
        }, 300)
    }, d.utils.initPjax = function() {
        var c = $("a.pjax");
        c.on("click", d.utils.onPjaxClick), $(b).on("pjax:end", function() {
            d.cache.CallInit && (d.cache.CallInit = !1, ga("set", "location", a.location.href), ga("send", "pageview"), $(b).off("pjax:end"), c.off("click", d.utils.onPjaxClick), d.utils.initPjax(), d.utils.onPjaxLoad(), setTimeout(function() {
                $("#page").removeClass("fade")
            }, 400))
        })
    }, d.utils.onPjaxClick = function(a) {
        var b = $(this),
            c = b.attr("href");
        if (a.preventDefault(), "undefined" != typeof b.data("ga")) {
            var e = b.data("ga").split("_");
            ga("send", "event", e[0], e[1], e[2])
        }
        $("#page").addClass("fade"), setTimeout(function() {
            $.pjax({
                url: c,
                container: "#page",
                fragment: "#page"
            })
        }, 200), d.cache.CallInit = !0
    }, d.utils.onPjaxLoad = function() {
        d.utils.partialLoad()
    }, d.utils.scroll = function(a, b) {
        var c = d.cache.isDetail ? 0 : $(".home", d.cache.body).height(),
            e = d.cache.isDetail ? $(".screen", d.cache.body).height() : $(".works", d.cache.body).height(),
            f = c + e - b - 5;
        d.cache.window.off("scroll onscroll"), d.cache.isDetail ? d.cache.window.on("scroll onscroll", {
            pageHeight: f
        }, d.utils.onScrollDetail) : d.cache.window.on("scroll onscroll", {
            pageHeight: f
        }, d.utils.onScrollHP)
    }, d.utils.onScrollHP = function(a) {
        var b = d.cache.window.scrollTop();
        b > 100 ? d.cache.header.addClass("small") : $(".page").hasClass("act") || d.cache.header.removeClass("small"), b >= a.data.pageHeight ? $("#page").addClass("footer-act") : b <= a.data.pageHeight - 118 && $("#page").removeClass("footer-act"), b >= d.cache.workPosition - 120 ? $("#js-go-to-work").addClass("act") : $("#js-go-to-work").removeClass("act")
    }, d.utils.onScrollDetail = function(a) {
        var b = d.cache.window.scrollTop();
        $("html, body").stop(), b > 10 ? d.cache.header.hasClass("act") || d.cache.header.addClass("hidden") : $("#page").hasClass("act") || d.cache.header.removeClass("hidden"), b >= a.data.pageHeight ? $(".page").addClass("footer-act") : b <= a.data.pageHeight - 118 && $(".page").removeClass("footer-act")
    }, d.utils.onMouseMove = function(a) {
        a.pageX < .25 * d.cache.window.width() ? $("#js-prev-arr").addClass("active") : ($("#js-prev-arr").removeClass("active"), a.pageX > .75 * d.cache.window.width() ? $("#js-next-arr").addClass("active") : $("#js-next-arr").removeClass("active"))
    }, d.utils.btnopen = function() {
        var a = $(".open-contact, .open-about, .go-to-top, .go-to-work");
        a.on("click", function(a) {
            var b, c = $(this),
                e = c.attr("href");
            if ("/#work" !== e) {
                if ("/" === e) d.cache.isDetail ? setTimeout(function() {
                    $.pjax({
                        url: "/",
                        container: "#page",
                        fragment: "#page"
                    })
                }, 200) : (a.preventDefault(), b = 0);
                else {
                    var f = d.cache.isLayerOpened ? 758 : 119;
                    a.preventDefault(), b = $(e).offset().top - f
                }
                d.utils.scrollto(b), ("#about" === e || "#contact" === e) && d.utils.openLayer(e), c.addClass("act")
            }
            $(e).length && a.preventDefault()
        })
    }, d.utils.openLayer = function(a) {
        d.utils.scrollto(0), d.cache.header.addClass("act"), $(".page").addClass("act"), $(".overlay").addClass("act"), $(a).addClass("act"), "#about" === a && d.cache.videoImage !== c && (d.cache.isLayerEgo = !0, d.utils.initVideo()), d.cache.header.addClass("small"), d.cache.isLayerOpened = !0, d.cache.isDetail || (d.cache.window.off("scroll onscroll", d.utils.onParallax), d.cache.window.off("scroll onscroll", d.utils.onReduceOpacity))
    }, d.utils.closeLayerInit = function() {
        $(".overlay, .about .close, .contact .close").on("click", function(a) {
            a.preventDefault(), d.utils.closelayer()
        })
    }, d.utils.closelayer = function() {
        d.cache.header.removeClass("act"), $(".page").removeClass("act"), $(".overlay").removeClass("act"), $("#about").removeClass("act"), $("#contact").removeClass("act"), d.cache.isLayerEgo = !1, clearInterval(d.cache.videoInterval), $(".act", d.cache.header).removeClass("act"), d.cache.isDetail || (d.cache.header.removeClass("small"), d.cache.isLayerOpened = !1, d.cache.body.css("overflow", ""), d.utils.initParallax(d.cache.parallaxSpeed), d.utils.initReduceOpacity(d.cache.maxOpacity))
    }, d.utils.loadVideo = function() {
        d.cache.videoImage = d.cache.video.find("#poster"), d.cache.videoImage.attr("src", d.cache.videoImage.data("video")), d.cache.videoImage.css("width", "100%"), d.cache.videoImage.addClass("hidden"), d.cache.videoImage.load(function() {
            $(this).removeClass("hidden")
        })
    }, d.utils.resizeVideo = function() {
        var a = d.cache.video.width() / 580;
        console.log(a), d.cache.videoImage.css("height", 500 * a)
    }, d.utils.initVideo = function() {
        var a = 0,
            b = d.cache.video.width() / '100%';
        console.log(b), d.cache.videoImage.css("height", 500 * b), d.cache.videoInterval = setInterval(function() {
            d.cache.videoImage.css(d.utils.transtale3d(d.cache.video.width() * -a, 0, 0)), a = 12 >= a ? a + 1 : 0
        }, 700)
    }, d.utils.initParallax = function(a) {
        d.cache.body.find(".parallaxMe", d.cache.body).each(function() {
            var b = $(this);
            b.css(d.utils.transtale3d(0, 0, 0)), d.cache.window.on("scroll onscroll", {
                $elem: b,
                speed: a
            }, d.utils.onParallax)
        })
    }, d.utils.onParallax = function(a) {
        var b = d.cache.window.scrollTop() * a.data.speed;
        a.data.$elem.css(d.utils.transtale3d(0, b, 0))
    }, d.utils.transtale3d = function(a, b, c) {
        var d = "translate3d(" + a + "px," + b + "px," + c + ")";
        return {
            WebkitTransform: d,
            MozTransform: d,
            MsTransform: d,
            OTransform: d,
            transform: d
        }
    }, d.utils.initReduceOpacity = function(a) {
        var b = d.cache.window.height() - 118;
        d.cache.body.find(".shadeOverlay", d.cache.body).each(function() {
            var c = $(this);
            c.css("opacity", 1), d.cache.window.on("scroll onscroll", {
                $elem: c,
                maxOpacity: a,
                windowHeight: b
            }, d.utils.onReduceOpacity)
        })
    }, d.utils.onReduceOpacity = function(b) {
        b.data.$elem.css("opacity", (a.pageYOffset || d.cache.window.scrollTop()) / b.data.windowHeight * b.data.maxOpacity)
    }, d.utils.initSocials = function() {
        $("#facebook").click(function(b) {
            b.preventDefault(), a.open($(this).attr("href"), "Facebook", "menubar=0,resizable=1,width=640,height=355")
        }), $("#twitter").click(function(b) {
            b.preventDefault(), a.open($(this).attr("href"), "Twitter", "menubar=0,resizable=1,width=640,height=440")
        }), $("#google").click(function(b) {
            b.preventDefault(), a.open($(this).attr("href"), "Google+", "menubar=0,resizable=1,width=500,height=360")
        })
    }, d.utils.partialLoad = function() {
        var b = $(".animate", d.cache.body);
        $("#js-header").removeClass("hidden"), b.off("mouseenter", d.utils.animateIconsOnHover).off("mouseleave", d.utils.destroyAnimatedIcon).on("mouseenter", d.utils.animateIconsOnHover).on("mouseleave", d.utils.destroyAnimatedIcon), $("#js-open-menu").on("click", function(a) {
            a.preventDefault(), d.cache.header.hasClass("act") && d.utils.closelayer(), d.cache.header.hasClass("header-opened") ? d.cache.header.removeClass("header-opened") : d.cache.header.addClass("header-opened")
        }), null !== d.cache.swiffyObject && d.cache.swiffyObject.destroy(), -1 == a.location.pathname.indexOf("index.php") && "/" !== a.location.pathname ? (d.cache.isDetail = !0, d.cache.body.on("mousemove", d.utils.onMouseMove), d.cache.header.addClass("hello"), d.cache.body.addClass("detail-page"), $("#js-go-to-work").removeClass("act").attr("href", "/#work").addClass("pjax").on("click", d.utils.onPjaxClick), $("li", "#js-desc").removeClass("fade")) : (d.cache.isDetail = !1, d.utils.initParallax(d.cache.parallaxSpeed), d.utils.initReduceOpacity(d.cache.maxOpacity), d.cache.body.removeClass("detail-page"), $("#js-go-to-work").attr("href", "#work").removeClass("pjax")), d.utils.initSocials(), animatedIconsOnLoad(), d.utils.resize()
    }, d.utils.animateIconsOnHover = function() {
        var b = $(this),
            c = b.find("i");
        c.css("background-image", "none"), d.cache.swiffyObject = new swiffy.Stage(c[0], a[b.attr("data-animatedIcon")]), d.cache.swiffyObject.setBackground(null), d.cache.swiffyObject.start()
    }, d.utils.destroyAnimatedIcon = function() {
        var a = $(this),
            b = a.find("i");
        null !== d.cache.swiffyObject && (d.cache.swiffyObject.destroy(), b.css("background-image", ""))
    }, d.utils.domLoad = function() {
        d.utils.requestAnimationFrame(), d.cache.window.smartresize(function() {
            d.utils.resize()
        }), d.utils.partialLoad(), d.utils.closeLayerInit(), d.cache.window.width() > 640 && d.utils.loadVideo(), d.cache.header.find("nav a").on("click", function() {
            d.cache.header.removeClass("header-opened")
        })
    }, d.utils.init(), jQuery(function(a) {
        a(b).ready(function() {
            d.utils.domLoad(), d.utils.initPjax()
        })
    })
}(window, document),
function(a, b) {
    var c = function(a, b, c) {
        var d;
        return function() {
            function e() {
                c || a.apply(f, g), d = null
            }
            var f = this,
                g = arguments;
            d ? clearTimeout(d) : c && a.apply(f, g), d = setTimeout(e, b || 100)
        }
    };
    jQuery.fn[b] = function(a) {
        return a ? this.bind("resize", c(a)) : this.trigger(b)
    }
}(jQuery, "smartresize");
